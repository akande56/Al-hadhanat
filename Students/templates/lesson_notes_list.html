{% extends 'dashboard.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% block content %}
    <div class="row text-center">
      <form method="get">
        {{ filter_form|crispy }}
        <button type="submit" class="btn-success mb-3 shadow">Apply Filters</button>
      </form>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th colspan="10">CLASS: {{classname}} Lesson Notes</th>
          </tr>
          <tr>
            <th scope="col" class="text-info">Subject</th>
            <th scope="col" class="text-info">Lesson Date</th>
            <th scope="col" class="text-info">Topic</th>
            <th scope="col" class="text-info">Term</th>
            <th scope="col" class="text-info">Session</th>
            <th scope="col" class="text-info">Teacher</th>            
          </tr>
        </thead>
        <tbody>
          {% for note in lesson_notes %}
          <tr>
            <td>
                {{ note.subject }}
            </td>
            <td>
                {{ note.lesson_date }}
            </td>
            <td>
              {{ note.topic }}
            </td>
            <td>
                {{ note.term }}
            </td>
            <td>
                {{ note.session }}
            </td>
            <td>
                  {{ note.teacher }}
            </td>
            </td>
            <td>
              
                <button type="button" class="btn btn-success edit-lesson-note-button" data-toggle="modal" data-target="#editLessonNoteModal{{ note.id }}">
                  <i class="fas fa-cogs"></i>
                </button>
                
            </td>
            <td>
                <!-- <button class="btn btn-primary edit-lesson-note-button" data-toggle="modal" data-target="#editLessonNoteModal{{ note.id }}">Edit</button> -->
                <a href="{% url 'delete_lesson_note' note.id %}" class="btn btn-danger fas fa-trash-alt"></a>
            </td>
          </tr>
          <!-- Edit Lesson Note Modal for each lesson note -->
          <div class="modal fade" id="editLessonNoteModal{{ note.id }}" tabindex="-1" role="dialog" aria-labelledby="editLessonNoteModalLabel{{ note.id }}" aria-hidden="true">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="editLessonNoteModalLabel{{ note.id }}">Edit Lesson Note</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <form method="post" class="lesson-form" action="{% url 'edit_lesson_notes' note.id %}">
                    {% csrf_token %}
                    {{ form.as_p }}
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                  </form>
                </div>
              </div>
            </div>
          </div>
          <script>
            // Get the lesson note ID from the button's data attribute
            var lessonNoteId = {{ note.id }};

            // Set initial values in the form fields
            $(document).ready(function() {
            $('#id_term').val('{{ note.term }}');
              $('#id_instructional_materials').val('{{ note.instructional_materials }}');
              $('#id_introduction').val('{{ note.introduction|safe }}');
              $('#id_lesson_date').val('{{ note.lesson_date|date:"Y-m-d" }}');
              $('#id_subject').val('{{ note.subject }}');
              $('#id_topic').val('{{note.topic }}');
              $('#id_objectives').val('{{note.objectives|safe }}');
              $('#id_knowledge').val('{{note.previous_knowledge }}');
              $('#id_lesson_content').val('{{note.lesson_content|safe }}');
              $('#id_teaching_methodology').val('{{note.teaching_methodology }}');
              $('#id_assessment').val('{{note.assessment|safe }}');
              $('#id_conclusion').val('{{note.conclusion|safe }}');
              $('#id_homework_assignment').val('{{note.homework_assignment|safe }}');
              $('#id_previous_knowledge').val('{{note.previous_knowledge|safe }}');
            });
          </script>
          {% endfor %}

        </tbody>
      </table>
      {% if is_paginated %}
            <nav aria-label="Page navigation example">
                <ul class="pagination justify-content-center">
                    {% if page_obj.has_previous %}
                    <li class="page-item"><a class="page-link"
                            href="?page={{ page_obj.previous_page_number }}">&laquo;</a></li>
                    {% else %}
                    <li class="page-item disabled"><a class="page-link" href="#">Previous</a></li>
                    {% endif %}
                    {% for i in paginator.page_range %}
                    {% if page_obj.number == i %}
                    <li class="page-item active"><a class="page-link" href="#">{{ i }} <span
                                class="sr-only">(current)</span></a></li>
                    {% else %}
                    <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
                    {% endif %}
                    {% endfor %}
                    {% if page_obj.has_next %}
                    <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">&raquo;</a>
                    </li>
                    {% else %}
                    <li class="page-item disabled"><a class="page-link" href="#">Next</a></li>
                    {% endif %}
                </ul>
            </nav>
        {% endif %}
    </div>
    <script defer src="https://cdn.ckeditor.com/4.16.2/standard/ckeditor.js"></script>
{% endblock content %}